name: Check Mega Branch Merge

on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches:
      - main

jobs:
  check-mega:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Check if branch was merged to mega
        run: |
          # Verifica se a branch de origem foi mergeada na mega
          git fetch origin mega

          # Pega a base comum entre a branch atual e mega
          MERGE_BASE=$(git merge-base HEAD origin/mega)

          # Verifica se mega contém a base
          if ! git merge-base --is-ancestor $MERGE_BASE origin/mega; then
            echo "❌ Esta branch ainda não passou por mega"
            exit 1
          fi

          echo "✅ Branch já passou por mega"
